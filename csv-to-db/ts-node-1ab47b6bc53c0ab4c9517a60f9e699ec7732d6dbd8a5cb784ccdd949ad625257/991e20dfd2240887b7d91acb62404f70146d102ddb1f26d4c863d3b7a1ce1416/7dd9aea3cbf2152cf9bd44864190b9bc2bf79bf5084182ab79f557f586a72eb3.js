"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var fs = require("fs");
var csv = require("csv-parser");
var model_1 = require("./model");
var config_1 = require("./config");
/**
 * To run this file you need to run
 * 'npm install' and then run
 * 'ts-node main.ts' in your terminal
 */
var separator = ',';
function validate(data) {
    if (!data) {
        return false;
    }
    var errors = {};
    // name
    // @ts-ignore
    var validationObj = config_1.config.csv.find(function (obj) { return obj.name === 'name'; });
    errors.name = config_1.checkLength(validationObj.minLength, validationObj.maxLength)(data.name)
        && new RegExp(validationObj.regExp, 'g').test(data.name);
    // age
    // @ts-ignore
    validationObj = config_1.config.csv.find(function (obj) { return obj.name === 'age'; });
    errors.age = config_1.checkLength(validationObj.minLength, validationObj.maxLength)(data.age)
        && new RegExp(validationObj.regExp, 'g').test(data.age)
        && config_1.checkMinMax(validationObj.min, validationObj.max)(+data.age);
    // date
    // @ts-ignore
    validationObj = config_1.config.csv.find(function (obj) { return obj.name === 'date'; });
    var date = new model_1.RegistrationDate(data.date);
    errors.date = config_1.checkLength(validationObj.minLength, validationObj.maxLength)(date)
        && config_1.checkMinMax(validationObj.minYear, validationObj.maxYear)(date.year)
        && config_1.checkMinMax(validationObj.minMonth, validationObj.maxMonth)(date.month)
        && config_1.checkMinMax(validationObj.minDay, validationObj.maxDay)(date.day);
    // time
    // @ts-ignore
    validationObj = config_1.config.csv.find(function (obj) { return obj.name === 'time'; });
    var time = new model_1.RegistrationTime(data.time);
    errors.time = config_1.checkLength(validationObj.minLength, validationObj.maxLength)(time)
        && config_1.checkMinMax(validationObj.minHour, validationObj.maxHour)(time.hours)
        && config_1.checkMinMax(validationObj.minMinute, validationObj.maxMinute)(time.minutes);
    // email
    // @ts-ignore
    validationObj = config_1.config.csv.find(function (obj) { return obj.name === 'email'; });
    var email = new model_1.Email(data.email);
    errors.email = config_1.checkLength(validationObj.minLength, validationObj.maxLength)(email)
        && new RegExp(validationObj.regExpName, 'g').test(email.name)
        && new RegExp(validationObj.regExpDomain).test(email.domain);
    // phone
    // @ts-ignore
    validationObj = config_1.config.csv.find(function (obj) { return obj.name === 'phone'; });
    var phone = new model_1.Phone(data.phone);
    errors.phone = config_1.checkLength(validationObj.minLength, validationObj.maxLength)(phone);
    // return false is errors object has false in any property
    // console.log('-->', errors);
    return !Object.keys(errors).some(function (item) { return !errors[item]; });
}
exports.validate = validate;
var results = [];
var errors = [];
function saveToDB(results) {
    // save to db
}
function makeCsvFile(array) {
    if (array.length) {
        var writer_1 = fs.createWriteStream('assets/invalid.csv');
        writer_1.write(Object.keys(array[0]).join(separator) + '\n');
        array.forEach(function (item) {
            var arr = [];
            for (var key in item) {
                arr.push(item[key]);
            }
            writer_1.write(arr.join(separator) + '\n');
        });
        writer_1.close();
    }
}
fs.createReadStream('assets/Users.csv')
    .pipe(csv({ separator: separator }))
    .on('data', function (data) {
    (validate(data) ? results : errors).push(data);
})
    .on('end', function () {
    saveToDB(results);
    makeCsvFile(errors);
    console.log('res', results);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3Zlcm9uaWthYm9nZGFub3ZpY2gvRG93bmxvYWRzL2Nzdi10by1kYi9tYWluLnRzIiwic291cmNlcyI6WyIvVXNlcnMvdmVyb25pa2Fib2dkYW5vdmljaC9Eb3dubG9hZHMvY3N2LXRvLWRiL21haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx1QkFBeUI7QUFDekIsZ0NBQWtDO0FBQ2xDLGlDQUFtRjtBQUNuRixtQ0FBMEQ7QUFFMUQ7Ozs7R0FJRztBQUVILElBQU0sU0FBUyxHQUFXLEdBQUcsQ0FBQztBQUU5QixTQUFnQixRQUFRLENBQUMsSUFBYztJQUN0QyxJQUFHLENBQUMsSUFBSSxFQUFFO1FBQ1QsT0FBTyxLQUFLLENBQUM7S0FDYjtJQUVELElBQU0sTUFBTSxHQUFRLEVBQUUsQ0FBQztJQUV2QixPQUFPO0lBQ1AsYUFBYTtJQUNiLElBQUksYUFBYSxHQUFHLGVBQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLElBQUksS0FBSyxNQUFNLEVBQW5CLENBQW1CLENBQUMsQ0FBQztJQUNoRSxNQUFNLENBQUMsSUFBSSxHQUFHLG9CQUFXLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztXQUNsRixJQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFMUQsTUFBTTtJQUNOLGFBQWE7SUFDYixhQUFhLEdBQUcsZUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxHQUFHLENBQUMsSUFBSSxLQUFLLEtBQUssRUFBbEIsQ0FBa0IsQ0FBQyxDQUFDO0lBQzNELE1BQU0sQ0FBQyxHQUFHLEdBQUcsb0JBQVcsQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLGFBQWEs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QUcsSUFBSSxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7S0FDZjtBQUNGLENBQUM7QUFFRCxFQUFFLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLENBQUM7S0FDckMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFDO0tBQ2pDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsVUFBQyxJQUFjO0lBQzFCLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoRCxDQUFDLENBQUM7S0FDRCxFQUFFLENBQUMsS0FBSyxFQUFFO0lBQ1YsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2xCLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNwQixPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztBQUM3QixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIGNzdiBmcm9tICdjc3YtcGFyc2VyJztcbmltcG9ydCB7Q3N2TW9kZWwsIEVtYWlsLCBQaG9uZSwgUmVnaXN0cmF0aW9uRGF0ZSwgUmVnaXN0cmF0aW9uVGltZX0gZnJvbSAnLi9tb2RlbCc7XG5pbXBvcnQge2NoZWNrTGVuZ3RoLCBjaGVja01pbk1heCwgY29uZmlnfSBmcm9tICcuL2NvbmZpZyc7XG5cbi8qKlxuICogVG8gcnVuIHRoaXMgZmlsZSB5b3UgbmVlZCB0byBydW5cbiAqICducG0gaW5zdGFsbCcgYW5kIHRoZW4gcnVuXG4gKiAndHMtbm9kZSBtYWluLnRzJyBpbiB5b3VyIHRlcm1pbmFsXG4gKi9cblxuY29uc3Qgc2VwYXJhdG9yOiBzdHJpbmcgPSAnLCc7XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZShkYXRhOiBDc3ZNb2RlbCk6IGJvb2xlYW4ge1xuXHRpZighZGF0YSkge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdGNvbnN0IGVycm9yczogYW55ID0ge307XG5cblx0Ly8gbmFtZVxuXHQvLyBAdHMtaWdub3JlXG5cdGxldCB2YWxpZGF0aW9uT2JqID0gY29uZmlnLmNzdi5maW5kKG9iaiA9PiBvYmoubmFtZSA9PT0gJ25hbWUnKTtcblx0ZXJyb3JzLm5hbWUgPSBjaGVja0xlbmd0aCh2YWxpZGF0aW9uT2JqLm1pbkxlbmd0aCwgdmFsaWRhdGlvbk9iai5tYXhMZW5ndGgpKGRhdGEubmFtZSlcblx0XHQmJiBuZXcgUmVnRXhwKHZhbGlkYXRpb25PYmoucmVnRXhwLCAnZycpLnRlc3QoZGF0YS5uYW1lKTtcblxuXHQvLyBhZ2Vcblx0Ly8gQHRzLWlnbm9yZVxuXHR2YWxpZGF0aW9uT2JqID0gY29uZmlnLmNzdi5maW5kKG9iaiA9PiBvYmoubmFtZSA9PT0gJ2FnZScpO1xuXHRlcnJvcnMuYWdlID0gY2hlY2tMZW5ndGgodmFsaWRhdGlvbk9iai5taW5MZW5ndGgsIHZhbGlkYXRpb25PYmoubWF4TGVuZ3RoKShkYXRhLmFnZSlcblx0XHQmJiBuZXcgUmVnRXhwKHZhbGlkYXRpb25PYmoucmVnRXhwLCAnZycpLnRlc3QoZGF0YS5hZ2UpXG5cdFx0JiYgY2hlY2tNaW5NYXgodmFsaWRhdGlvbk9iai5taW4sIHZhbGlkYXRpb25PYmoubWF4KSgrZGF0YS5hZ2UpO1xuXG5cdC8vIGRhdGVcblx0Ly8gQHRzLWlnbm9yZVxuXHR2YWxpZGF0aW9uT2JqID0gY29uZmlnLmNzdi5maW5kKG9iaiA9PiBvYmoubmFtZSA9PT0gJ2RhdGUnKTtcblx0Y29uc3QgZGF0ZSA9IG5ldyBSZWdpc3RyYXRpb25EYXRlKGRhdGEuZGF0ZSk7XG5cdGVycm9ycy5kYXRlID0gY2hlY2tMZW5ndGgodmFsaWRhdGlvbk9iai5taW5MZW5ndGgsIHZhbGlkYXRpb25PYmoubWF4TGVuZ3RoKShkYXRlKVxuXHRcdCYmIGNoZWNrTWluTWF4KHZhbGlkYXRpb25PYmoubWluWWVhciwgdmFsaWRhdGlvbk9iai5tYXhZZWFyKShkYXRlLnllYXIpXG5cdFx0JiYgY2hlY2tNaW5NYXgodmFsaWRhdGlvbk9iai5taW5Nb250aCwgdmFsaWRhdGlvbk9iai5tYXhNb250aCkoZGF0ZS5tb250aClcblx0XHQmJiBjaGVja01pbk1heCh2YWxpZGF0aW9uT2JqLm1pbkRheSwgdmFsaWRhdGlvbk9iai5tYXhEYXkpKGRhdGUuZGF5KTtcblxuXHQvLyB0aW1lXG5cdC8vIEB0cy1pZ25vcmVcblx0dmFsaWRhdGlvbk9iaiA9IGNvbmZpZy5jc3YuZmluZChvYmogPT4gb2JqLm5hbWUgPT09ICd0aW1lJyk7XG5cdGNvbnN0IHRpbWUgPSBuZXcgUmVnaXN0cmF0aW9uVGltZShkYXRhLnRpbWUpO1xuXHRlcnJvcnMudGltZSA9IGNoZWNrTGVuZ3RoKHZhbGlkYXRpb25PYmoubWluTGVuZ3RoLCB2YWxpZGF0aW9uT2JqLm1heExlbmd0aCkodGltZSlcblx0XHQmJiBjaGVja01pbk1heCh2YWxpZGF0aW9uT2JqLm1pbkhvdXIsIHZhbGlkYXRpb25PYmoubWF4SG91cikodGltZS5ob3Vycylcblx0XHQmJiBjaGVja01pbk1heCh2YWxpZGF0aW9uT2JqLm1pbk1pbnV0ZSwgdmFsaWRhdGlvbk9iai5tYXhNaW51dGUpKHRpbWUubWludXRlcyk7XG5cblx0Ly8gZW1haWxcblx0Ly8gQHRzLWlnbm9yZVxuXHR2YWxpZGF0aW9uT2JqID0gY29uZmlnLmNzdi5maW5kKG9iaiA9PiBvYmoubmFtZSA9PT0gJ2VtYWlsJyk7XG5cdGNvbnN0IGVtYWlsID0gbmV3IEVtYWlsKGRhdGEuZW1haWwpO1xuXHRlcnJvcnMuZW1haWwgPSBjaGVja0xlbmd0aCh2YWxpZGF0aW9uT2JqLm1pbkxlbmd0aCwgdmFsaWRhdGlvbk9iai5tYXhMZW5ndGgpKGVtYWlsKVxuXHRcdCYmIG5ldyBSZWdFeHAodmFsaWRhdGlvbk9iai5yZWdFeHBOYW1lLCAnZycpLnRlc3QoZW1haWwubmFtZSlcblx0XHQmJiBuZXcgUmVnRXhwKHZhbGlkYXRpb25PYmoucmVnRXhwRG9tYWluKS50ZXN0KGVtYWlsLmRvbWFpbik7XG5cblx0Ly8gcGhvbmVcblx0Ly8gQHRzLWlnbm9yZVxuXHR2YWxpZGF0aW9uT2JqID0gY29uZmlnLmNzdi5maW5kKG9iaiA9PiBvYmoubmFtZSA9PT0gJ3Bob25lJyk7XG5cdGNvbnN0IHBob25lID0gbmV3IFBob25lKGRhdGEucGhvbmUpO1xuXHRlcnJvcnMucGhvbmUgPSBjaGVja0xlbmd0aCh2YWxpZGF0aW9uT2JqLm1pbkxlbmd0aCwgdmFsaWRhdGlvbk9iai5tYXhMZW5ndGgpKHBob25lKTtcblxuXHQvLyByZXR1cm4gZmFsc2UgaXMgZXJyb3JzIG9iamVjdCBoYXMgZmFsc2UgaW4gYW55IHByb3BlcnR5XG5cdC8vIGNvbnNvbGUubG9nKCctLT4nLCBlcnJvcnMpO1xuXHRyZXR1cm4gIU9iamVjdC5rZXlzKGVycm9ycykuc29tZShpdGVtID0+ICFlcnJvcnNbaXRlbV0pXG59XG5cbmNvbnN0IHJlc3VsdHM6IEFycmF5PENzdk1vZGVsPiA9IFtdO1xuY29uc3QgZXJyb3JzOiBBcnJheTxDc3ZNb2RlbD4gPSBbXTtcblxuZnVuY3Rpb24gc2F2ZVRvREIocmVzdWx0czogQXJyYXk8Q3N2TW9kZWw+KSB7XG5cdC8vIHNhdmUgdG8gZGJcbn1cblxuZnVuY3Rpb24gbWFrZUNzdkZpbGUoYXJyYXk6IEFycmF5PENzdk1vZGVsPik6IHZvaWQge1xuXHRpZiAoYXJyYXkubGVuZ3RoKSB7XG5cdFx0bGV0IHdyaXRlciA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKCdhc3NldHMvaW52YWxpZC5jc3YnKTtcblxuXHRcdHdyaXRlci53cml0ZShPYmplY3Qua2V5cyhhcnJheVswXSkuam9pbihzZXBhcmF0b3IpICsgJ1xcbicpO1xuXHRcdGFycmF5LmZvckVhY2goaXRlbSA9PiB7XG5cdFx0XHRsZXQgYXJyID0gW107XG5cblx0XHRcdGZvciAobGV0IGtleSBpbiBpdGVtKSB7XG5cdFx0XHRcdGFyci5wdXNoKGl0ZW1ba2V5XSk7XG5cdFx0XHR9XG5cblx0XHRcdHdyaXRlci53cml0ZShhcnIuam9pbihzZXBhcmF0b3IpICsgJ1xcbicpO1xuXHRcdH0pO1xuXG5cdFx0d3JpdGVyLmNsb3NlKCk7XG5cdH1cbn1cblxuZnMuY3JlYXRlUmVhZFN0cmVhbSgnYXNzZXRzL1VzZXJzLmNzdicpXG5cdC5waXBlKGNzdih7c2VwYXJhdG9yOiBzZXBhcmF0b3J9KSlcblx0Lm9uKCdkYXRhJywgKGRhdGE6IENzdk1vZGVsKSA9PiB7XG5cdFx0KHZhbGlkYXRlKGRhdGEpID8gcmVzdWx0cyA6IGVycm9ycykucHVzaChkYXRhKTtcblx0fSlcblx0Lm9uKCdlbmQnLCAoKSA9PiB7XG5cdFx0c2F2ZVRvREIocmVzdWx0cyk7XG5cdFx0bWFrZUNzdkZpbGUoZXJyb3JzKTtcblx0XHRjb25zb2xlLmxvZygncmVzJywgcmVzdWx0cyk7XG5cdH0pOyJdfQ==